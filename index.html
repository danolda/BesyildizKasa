<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8lık sonucunu gösteren bir "önizleme" alanı eklendi. Örneğin, ekranda `10 + 5">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Günlük Kasa Veri Girişi</title>
    <style>
         * 2` yazarken, önizleme alanında anlık olarak `20` sonucu görünecek.
4.body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background-color: #f4f4f9; color: #333; }
        .container { max-width: 1400px; margin  **Kullanıcı Dostu Mantık:** Artık tüm ifadeyi ekranda görerek işlem yapacaksınız, bu da hata yapma olasılığını azaltır.
5.  **Temizlik:** "İşlem Geçmiş: 20px auto; padding: 20px; background-color: #fff; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h1, h2 { color: #d9534f;i" paneline, geçmişi temizlemek için bir "Geçmişi Temizle" butonu eklendi.

 border-bottom: 2px solid #f0ad4e; padding-bottom: 10px;Bu değişiklikler sadece yeni eklenen **Hesap Makinesi** bölümünü etkiler ve mevcut kasa raporu fonksiyonlarınızı değiştir }
        .grid-container { display: grid; grid-template-columns: repeat(auto-fit,mez.

Lütfen aşağıdaki kodun **tamamını** kopyalayıp mevcut `.html` dosyan minmax(480px, 1fr)); gap: 40px; }
        .sectionızın içeriğiyle değiştirin.

---

### Final Web Sitesi Kodu (İşlem Geçmiş { background-color: #f9f9f9; padding: 20px; border-radius:li ve Canlı Önizlemeli Hesap Makinesi)

```html
<!DOCTYPE html>
<html lang 8px; border: 1px solid #ddd; }
        .instructions { margin-bottom: ="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport25px; background-color: #eef7ff; padding: 15px; border-radius" content="width=device-width, initial-scale=1.0">
    <title>Günlük: 5px; border-left: 5px solid #007bff; }
        .instructions Kasa Veri Girişi</title>
    <style>
        body { font-family: -apple ol { padding-left: 20px; margin: 5px 0 0 0; } .-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin:instructions li { margin-bottom: 5px; }
        .form-group { margin-bottom:  0; background-color: #f4f4f9; color: #333; }
15px; } .form-group label { display: block; font-weight: bold; margin-bottom        .container { max-width: 1400px; margin: 20px auto; padding: 5px; color: #555; }
        .form-group input, .form-: 20px; background-color: #fff; border-radius: 8px; box-shadow: 0group select { width: 100%; padding: 10px; border: 1px solid # 4px 8px rgba(0,0,0,0.1); }
        h1,ccc; border-radius: 4px; box-sizing: border-box; font-size: 1 h2 { color: #d9534f; border-bottom: 2px solid #f0em; background-color: white; }
        input[readonly] { background-color: #eee; cursorad4e; padding-bottom: 10px; }
        .grid-container { display: grid: not-allowed; }
        .total-display { margin-top: 20px; padding:; grid-template-columns: repeat(auto-fit, minmax(480px, 1fr 15px; background-color: #f0ad4e; color: #fff; font-size)); gap: 40px; }
        .section { background-color: #f9f9f: 1.5em; font-weight: bold; text-align: center; border-radius: 9; padding: 20px; border-radius: 8px; border: 1px solid #4px; }
        .dynamic-list .item { display: flex; gap: 10px;ddd; }
        .instructions { margin-bottom: 25px; background-color: #eef margin-bottom: 10px; align-items: center; }
        .dynamic-list .item:7ff; padding: 15px; border-radius: 5px; border-left: 5not(.fixed-item) > *:nth-child(1) { flex: 2.5; } .dynamic-listpx solid #007bff; }
        .instructions ol { padding-left: 20px; .item:not(.fixed-item) > *:nth-child(2) { flex: 1.5 margin: 5px 0 0 0; } .instructions li { margin-bottom: 5px; }
        .form-group { margin-bottom: 15px; } .form-group label; } .dynamic-list .item:not(.fixed-item) > *:nth-child(3) { { display: block; font-weight: bold; margin-bottom: 5px; color: #55 flex: 1; }
        .dynamic-list .item.fixed-item > *:nth-child(5; }
        .form-group input, .form-group select { width: 100%;1), #giderler-list .item > *:nth-child(1) { flex: 3; } .dynamic padding: 10px; border: 1px solid #ccc; border-radius: 4px;-list .item.fixed-item > *:nth-child(2), #giderler-list .item > *:nth-child(2) { flex: 2; }
        .btn { display: inline- box-sizing: border-box; font-size: 1em; background-color: white; }
        input[readonly] { background-color: #eee; cursor: not-allowed; }
        .totalblock; padding: 10px 15px; background-color: #5cb85c;-display { margin-top: 20px; padding: 15px; background-color: # color: white; border: none; border-radius: 4px; cursor: pointer; font-size:f0ad4e; color: #fff; font-size: 1.5em; font-weight 1em; margin-top: 10px; transition: background-color 0.2s;: bold; text-align: center; border-radius: 4px; }
        .dynamic-list }
        .btn:disabled { background-color: #cccccc; cursor: not-allowed; } .btn .item { display: flex; gap: 10px; margin-bottom: 10px; align-danger { background-color: #d9534f; } .btn-save { background-color: #f0ad4e; } .btn:hover:not(:disabled) { opacity: 0.-items: center; }
        .dynamic-list .item:not(.fixed-item) > *:nth-child(9; }
        .controls-container { display: flex; justify-content: center; align-items:1) { flex: 2.5; } .dynamic-list .item:not(.fixed-item) > *:nth-child(2) { flex: 1.5; } .dynamic-list .item: center; gap: 15px; margin-top: 10px; margin-bottom: 30px; flex-wrap: wrap; }
        .download-btn { background-color: #00not(.fixed-item) > *:nth-child(3) { flex: 1; }
        .7bff; font-size: 1.2em; padding: 15px 25px;dynamic-list .item.fixed-item > *:nth-child(1), #giderler-list .item > }
        footer { text-align: center; margin-top: 30px; padding: 1 *:nth-child(1) { flex: 3; } .dynamic-list .item.fixed-item > *:nth-child(2), #giderler-list .item > *:nth-child(2)5px 0; font-size: 0.8em; color: #777; border-top: 1px solid #eee; }

        /* --- YENİ BÖLÜM: H { flex: 2; }
        .btn { display: inline-block; padding: 10pxESAP MAKİNESİ STİLLERİ --- */
        .calculator-wrapper { display: flex; justify 15px; background-color: #5cb85c; color: white; border: none; border--content: center; align-items: flex-start; gap: 20px; margin-top:radius: 4px; cursor: pointer; font-size: 1em; margin-top: 10px; transition: background-color 0.2s; }
        .btn:disabled { background- 40px; padding-top: 20px; border-top: 2px solid #f0ad4e; flex-wrap: wrap; }
        .calculator { width: 100%; max-width: 320px; background: #2a2d37; border-radius: color: #cccccc; cursor: not-allowed; } .btn-danger { background-color: #d9534f; } .btn-save { background-color: #f0ad4e; } .btn:hover:not(:disabled) { opacity: 0.9; }
        .controls-container { display: flex; justify-content: center; align-items: center; gap: 15px; margin-top: 10px; margin-bottom: 30px; flex-wrap: wrap; }
        .download-btn { background-color: #007bff; font-size: 1.10px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .calculator-display { width: 100%; background: #3a3f4d; color: white; text-align: right; padding: 15px; border-radius: 8px; margin-bottom: 20px; box-sizing: border-box; }
        .calculator-display .expression { font-size: 1.2em; color: #a5a5a5; min-height: 25px; word-wrap: break-word; word-break: break-all; }
        .calculator-display .current-value { font-size: 2.5em; min-height: 50px; word-wrap: break-word; word-break: break-all; }
        .calculator-keys { display: grid; grid-template-columns: repeat(2em; padding: 15px 25px; }
        footer { text-align: center; margin-top: 30px; padding: 15px 0; font-size: 0.8em; color: #777; border-top: 1px solid #eee; }
        
        /* --- HESAP MAKİNESİ STİLLERİ GÜNCELLENDİ --- */
        .calculator-wrapper { display: flex; justify-content: center; align-items: flex-start; gap: 20px; margin-top: 40px; padding-top: 20px; border-top: 2px solid #f0ad4e; flex-wrap: wrap; }
        .calculator { width: 100%; max-width: 360px; background: #2a2d37; border-radius: 10px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .calculator-display-container { background: #3a3f4d; color: white; border-radius: 8px; margin-bottom: 20px; padding: 10px 20px; text-align: right; }
        .calculator-expression { min-height: 35px; font-size: 1.5em; opacity: 0.7; word-wrap: break-word; word-break: break-all; }
        .calculator-result { font-size: 2.5em; font-weight4, 1fr); gap: 10px; }
        .calculator-keys button { height: 60px; border-radius: 8px; border: none; background: #323541; color: white; font-size: 1.5em; cursor: pointer; transition: background-color 0.2s; }
        .calculator-keys button:hover { background: #404452; }
        .calculator-keys .operator { background: #ff9f0a; color: white; }
        .calculator-keys .function { background: #a5a5a5; color: black; }
        .calculator-keys .equal-sign { background: #ff9f0a; }

        .history-panel { flex-grow: 1; max-width: 320px; min-width: 280px; padding: 20px; background: #f9f9f9; border: 1px solid #ddd; border-radius: 8px; }
        .history-panel h3 { margin-top: 0; color: #5bc0de; }
        .history-list { max-height: 250px; overflow-y: auto; background: #fff; border: 1px solid #ccc; border-radius: 4px; padding: 10px; }
        .history-list div { padding: : bold; min-height: 45px; }
        .calculator-keys { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .calculator-keys button { height: 65px; border-radius: 8px; border: none; background: #323541; color: white; font-size: 1.5em; cursor: pointer; transition: background-color 0.2s; }
        .calculator-keys button:hover { background: #404452; } .calculator-keys .operator { background: #ff9f0a; } .calculator-keys .function { background: #a5a5a5; color: black; }
        
5px; cursor: pointer; border-bottom: 1px solid #eee; }
        .history-list div:hover { background: #f0f0f0; }
        .history-list div:last-child { border-bottom: none; }
        .history-panel .btn-clear-history { width: 100%; margin-top: 10px; }

        @media (max-width: 76        .history-panel { flex-grow: 1; max-width: 400px; padding: 20px; background: #f9f9f9; border: 1px solid #ddd; border-radius: 8px; }
        .history-panel h3 { margin-top: 0; color: #5bc0de; display: flex; justify-content: space-between; align-items: center; }
        8px) {
            .grid-container { grid-template-columns: 1fr; }
            .dynamic-list .item { flex-direction: column; align-items: stretch; border: 1px solid #e0e0e0; padding: 10px; border-radius: 4px; }
            .dynamic-list .item > * { margin-bottom: 8px; } .dynamic-list .item > *:last-child { margin-bottom: 0; }
            .controls-container { flex-direction: column.history-panel h3 button { font-size: 0.7em; padding: 5px 10px; }
        .history-content { height: 280px; overflow-y: auto; background: #fff; border: 1px solid #ccc; border-radius: 4px; padding: 1; align-items: stretch; } .controls-container .btn { width: 100%; margin: 5px 0; }
            .calculator-wrapper { flex-direction: column; align-items:0px; text-align: right; }
        .history-item { padding: 5px; border center; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>-bottom: 1px solid #eee; font-size: 1.1em; }
        .history-itemGünlük Kasa Veri Girişi</h1>
    <!-- Kasa Raporu Bölümleri (DEĞİŞİKL span { display: block; }
        .history-item .expr { font-size: 0.8emİK YOK) -->
    <div class="instructions"><strong>İş Akışı Talimatları:</strong><ol; color: #888; }
        .history-item .res { font-weight: bold; }

        @media (max-width: 768px) {
            .grid-container {><li>Formu doldurduktan sonra "Veri Dosyasını İndir" butonu ile dosyayı telefonunuza kaydedin.</li><li>İndirilen dosyayı WhatsApp üzerinden kullandığınız telefonun numarasına gönderin. grid-template-columns: 1fr; }
            .dynamic-list .item { flex-direction:</li><li>Son olarak, Google E-Tablolar'daki "KASA İŞLEMLERİ" men column; align-items: stretch; border: 1px solid #e0e0e0; padding:üsünü kullanarak verileri içeri aktarın.</li></ol></div>
    <p><strong>Tarih: 10px; border-radius: 4px; }
            .dynamic-list .item > * { margin-</strong> <span id="current-date"></span></p>
    <div class="controls-container"><buttonbottom: 8px; } .dynamic-list .item > *:last-child { margin-bottom:  class="btn btn-save" onclick="saveDataToLocal()">Verileri Kaydet</button><button class="0; }
            .controls-container { flex-direction: column; align-items: stretch; } .controls-containerbtn download-btn" onclick="downloadDataFile()">Veri Dosyasını İndir</button><button class="btn .btn { width: 100%; margin: 5px 0; }
        }
     btn-danger" onclick="resetData()">Formu Sıfırla</button></div>
    <div class</style>
</head>
<body>

<div class="container">
    <!-- Kasa Raporu Böl="grid-container"><div class="section"><h2>Ana Veri Girişleri</h2><div class="form-ümleri (DEĞİŞİKLİK YOK) -->
    <h1>Günlük Kasa Veri Girişi</h1>group"><label for="genelCiro">GENEL TOPLAM FİŞ CİROSU</label><input type="text" inputmode="decimal" id="genelCiro" oninput="hesapla()"></div><div class="instructions"><strong>İş Akışı Talimatları:</strong><ol><li>Formu doldurdu<div class="form-group"><label for="vizaGiris">TEBBANKASI (Otomatik Hesktan sonra "Veri Dosyasını İndir" butonu ile dosyayı telefonunuza kaydedin.</li>aplanır)</label><input type="text" id="vizaGiris" readonly></div><div class="form-<li>İndirilen dosyayı WhatsApp üzerinden kullandığınız telefonun numarasına gönderin.</li><li>Son olarak, Googlegroup"><label for="fisSayisi">FİŞ SAYISI</label><input type="text" inputmode=" E-Tablolar'daki "KASA İŞLEMLERİ" menüsünü kullanarak verileri içeridecimal" id="fisSayisi" oninput="hesapla()"></div><div class="form-group">< aktarın.</li></ol></div>
    <p><strong>Tarih:</strong> <span id="currentlabel for="giderPusulasi">GİDER PUSULASI TOPLAM RAKAMINI YAZ-date"></span></p>
    <div class="controls-container"><button class="btn btn-saveINIZ</label><input type="text" inputmode="decimal" id="giderPusulasi" on" onclick="saveDataToLocal()">Verileri Kaydet</button><button class="btn download-btn" onclick="downloadDataFile()">Veri Dosyasını İndir</button><button class="btn btn-danger"input="hesapla()"></div><div class="form-group"><label for="kasaAcigi">KASA AÇIĞI YAZ</label><input type="text" inputmode="decimal" id="k onclick="resetData()">Formu Sıfırla</button></div>
    <div class="grid-containerasaAcigi" oninput="hesapla()"></div><div class="form-group"><label for="k"><div class="section"><h2>Ana Veri Girişleri</h2><div class="form-group"><label for="genelCiro">GENEL TOPLAM FİŞ CİROSU</label><input type="text"asaFazla">KASA FAZLA YAZ</label><input type="text" inputmode="decimal" inputmode="decimal" id="genelCiro" oninput="hesapla()"></div><div class=" id="kasaFazla" oninput="hesapla()"></div><div class="total-display">TOPform-group"><label for="vizaGiris">TEBBANKASI (Otomatik Hesaplanır)</labelLAM NAKİT KALAN PARA: <span id="toplamNakitKalan">0,00</span></div></div><div class="section"><h2>Giderler (Maks. 12)</h2><div><input type="text" id="vizaGiris" readonly></div><div class="form-group"><label for id="giderler-list" class="dynamic-list"></div><button class="btn" onclick="g="fisSayisi">FİŞ SAYISI</label><input type="text" inputmode="decimal" id="fisSayisi" oninput="hesapla()"></div><div class="form-group"><label for="giderEkle()">Yeni Gider Ekle</button></div><div class="section"><h2>Toptan SatiderPusulasi">GİDER PUSULASI TOPLAM RAKAMINI YAZINIZ</labelış (Maks. 15)</h2><div id="toptan-satis-list" class><input type="text" inputmode="decimal" id="giderPusulasi" oninput="hesap="dynamic-list"></div><button class="btn" onclick="toptanSatisEkle()">Yeni Toptan Satla()"></div><div class="form-group"><label for="kasaAcigi">KASA AÇIış Ekle</button></div><div class="section"><h2>Notlar</h2><div id="notlar-ĞI YAZ</label><input type="text" inputmode="decimal" id="kasaAcigi"list" class="dynamic-list"></div></div><div class="section"><h2>Düzenleyenler</h2><div class=" oninput="hesapla()"></div><div class="form-group"><label for="kasaFazla">form-group"><label for="editor1">Düzenleyen 1 (E15)</label><input typeKASA FAZLA YAZ</label><input type="text" inputmode="decimal" id="kasa="text" id="editor1" placeholder="İsim Girin"></div><div class="form-group"><Fazla" oninput="hesapla()"></div><div class="total-display">TOPLAM NAKİlabel for="editor2">Düzenleyen 2 (E16)</label><input type="text" id="editor2" placeholder="İsim Girin"></div></div><div class="section"><h2>Salt TEB Verisi</h2><div class="form-group"><label for="saltTeb">Ham VİZA Toplamını Girin</label><T KALAN PARA: <span id="toplamNakitKalan">0,00</span></div></div><div class="section"><h2>Giderler (Maks. 12)</h2><div id="giderler-list" class="dynamic-list"></div><button class="btn" onclick="giderEkle()">Yeni Gider Ekle</button></div><div class="section"><h2>Toptan Satış (Maks. 15)</h2><div id="toptan-satis-list" class="dynamic-list"></div><button class="btn" onclick="toptanSatisEkle()">Yeni Toptan Satış Ekle</button></div><div class="section"><h2>Notlar</h2><div id="notlar-list" class="input type="text" inputmode="decimal" id="saltTeb" placeholder="Örn: 150000" oninput="hesapla()"></div></div></div>
    
    <!-- YENİ BÖLÜM: HESAP MAKİNESİ -->
    <div class="calculator-wrapper">
        <div class="calculator">
            <div class="calculator-display">
                <div class="expressiondynamic-list"></div></div><div class="section"><h2>Düzenleyenler</h2><div class="form-group"><label for="editor1">Düzenleyen 1 (E15)</label><input type="text" id="editor1" placeholder="İsim Girin"></div><div class="form-group"><label for="editor2">Düzenleyen 2 (E16)</label><input type="text" id="editor2" placeholder="İsim Girin"></div></div><div class="section"><h2>Salt TEB Verisi</h2><div class="form-group"><label for="saltTeb">Ham VİZA Toplamını Girin</label><input type="text" inputmode="decimal" id="saltTeb" placeholder="Örn: 150000" oninput="hesapla()"></div></div></div>
    
    <!-- YENİ HESAP MAKİNESİ BÖLÜMÜ -->
    <div class="calculator-wrapper">
        <div class="calculator">
            <div class="calculator-display-container">
                <div class" id="calc-expression"></div>
                <div class="current-value" id="calc-current-value">0</div>
            </div>
            <div class="calculator-keys">
                <button class="function" data-key="clear">AC</button>
                <button class="function" data-key="backspace">⌫</button>
                <button class="operator" data-key="/">÷</button>
                <button class="operator" data-key="*">×</button>
                <button data-key="7">7</button>
                <button data-key="8">8</button>
                <button data-key="9">9</button>
                <button class="operator" data-key="-">−</button>
                <button data-key="4">4</button>
                <button data-key="5">5</button>
                <button data-key="6">6</button>
                <button class="operator" data-key="+">+</button>
                <button data-key="1">1</button>
                <="calculator-expression" id="calc-expression"> </div>
                <div class="calculator-result" id="calc-result">0</div>
            </div>
            <div class="calculator-keys">
                <button class="function" data-key="clear">AC</button>
                <button class="function" data-key="backspace">⌫</button>
                <button class="operator" data-key="%">%</button>
                <button class="operator" data-key="/">÷</button>

                <button data-key="7">7</button><button data-key="8">8</button><button data-key="9">9</button>
                <button class="operator" data-key="*">×</button>

                <button data-key="4">4</button><button data-key="5">5</button><button data-key="6">6</button>
                <button class="operator" data-key="-">−</button>

                <button data-key="1">1</button><button data-key="2">2</button><button data-key="3">3</button>
                <button class="operator" data-key="+">+</button>

                <button data-key="0">0</button><button data-key=".">.</button>
                <button class="operator" data-key="=" style="font-size: 2em;">=</button>
            </div>
        </div>
        <div class="history-panel">
            <h3>İşlem Geçmişi <button class="btn btn-danger" id="clear-history">Temizle</button></h3>
            <div class="history-content" id="button data-key="2">2</button>
                <button data-key="3">3</button>
                <button class="equal-sign" data-key="=" rowspan="2">=</button>
                <button data-key="0" style="grid-column: span 2">0</button>
                <button data-key=".">.</button>
            </div>
        </div>
        <div class="history-panel">
            <h3>İşlem Geçmişi</h3>
            <div class="history-list" id="history-list"></div>
            <button class="btn btn-danger btn-clear-history" id="clear-history">Geçmişi Temizle</button>
        </div>
    </div>
</div>
<footer>© Copyright 2025 by Melih Emre Karaköse. All Rights Reserved.</footer>

<script>
    // --- KASA RAPORU SCRIPT'İ (DEĞİŞİKLİK YOK) ---
    const MAX_GIDERLER = 12; const MAX_TOPTAN_SATIS = 15; const LOCAL_STORAGE_KEY = 'kasaRaporuVerileri'; const tarih = new Date(); const tarihYazisi = tarih.toLocaleDateString('tr-TR', { day: '2-digit', month: '2-digit', year: 'numeric' }) + " " + tarih.toLocaleDateString('tr-TR', { weekday: 'long' }).toUpperCase(); document.getElementById('current-date').textContent = tarihYazisi;
    function getFloat(id) { return parseFloat((document.getElementById(id).value.replace(/\./g, '').replace(',', '.')) || '0'); }
    function getFloatFromValue(valueStr) { return parseFloat((valueStr ? valueStr.replace(/\./g, '').replace(',', '.') : '0') || '0'); }
    history-content"></div>
        </div>
    </div>
</div>

<footer>© Copyright 2025 by Melih Emre Karaköse. All Rights Reserved.</footer>

<script>
    // --- KASA RAPORU SCRIPT'İ (DEĞİŞİKLİK YOK) ---
    const MAX_GIDERLER=12,MAX_TOPTAN_SATIS=15,LOCAL_STORAGE_KEY="kasaRaporuVerileri",tarih=new Date,tarihYazisi=tarih.toLocaleDateString("tr-TR",{day:"2-digit",month:"2-digit",year:"numeric"})+" "+tarih.toLocaleDateString("tr-TR",{weekday:"long"}).toUpperCase();document.getElementById("current-date").textContent=tarihYazisi;function getFloat(t){return parseFloat(document.getElementById(t).value.replace(/\./g,"").replace(",","."))||0}function getFloatFromValue(t){return parseFloat(t?t.replace(/\./g,"").replace(",","."):"0")||0}function hesapla(){let t=0;document.querySelectorAll("#toptan-satis-list .item:not(.fixed-item)").forEach(e=>{var o;("VİSA"===(null===(o=e.querySelector("select"))?void 0:o.value))&&(t+=getFloatFromValue(e.querySelector("input[type=text]:last-of-type").value))});let e=getFloat("saltTeb"),o=e-t;document.getElementById("vizaGiris").value=o.toFixed(2).replace(".",",");let n=getFloat("genelCiro"),i=n-o,r=0;document.querySelectorAll("#giderler-list .item input:last-of-type").forEach(t=>{r+=getFloatFromValue(t.value)}),r+=getFloat("giderPusulasi");let a=i-r,l=getFloat("kasaAcigi"),s=getFloat("kasaFazla"),c=a-l+s;document.getElementById("toplamNakitKalan").textContent=c.toFixed(2).replace(".",",")}const updatefunction hesapla() { let toptanVisaToplam = 0; document.querySelectorAll('#toptan-satis-list .item:not(.fixed-item)').forEach(item => { if (item.querySelector('select')?.value === 'VİSA') { toptanVisaToplam += getFloatFromValue(item.querySelector('input[type=text]:last-of-type').value); } }); const saltTeb = getFloat('saltTeb'); const tebbankasiDegeri = saltTeb - toptanVisaToplam; document.getElementById('vizaGiris').value = tebbankasiDegeri.toFixed(2).replace('.', ','); const genelCiro = getFloat('genelCiro'); const nakitGiris = genelCiro - tebbankasiDegeri; let giderlerToplami = 0; document.querySelectorAll('#giderler-list .item input:last-of-type').forEach(input => giderlerToplami += getFloatFromValue(input.value)); giderlerToplami += getFloat('giderPusulasi'); const nakitKalan = nakitGiris - giderlerToplami; const kasaAcigi = getFloat('kasaAcigi'); const kasaFazla = getFloat('kasaFazla'); const toplamNakitKalan = nakitKalan - kasaAcigi + kasaFazla; document.getElementById('toplamNakitKalan').textContent = toplamNakitKalan.toFixed(2).replace('.', ','); }
    const updateButtonStates = () => { document.querySelector('.section:has(#giderler-list) .btn').disabled = document.querySelectorAll('#giderler-list .item').length >= MAX_GIDERLER; document.querySelector('.section:has(#toptan-satis-list) .btn').disabled = document.querySelectorAll('#toptan-satis-list .item').length >= MAX_TOPTAN_SATIS; };
    function createDynamicItem(listId, itemData) { const list = document.getElementById(listId); const item = document.createElement('div'); item.className = 'item'; if (itemData.isFixed) item.classList.add('fixed-item'); const keyInput = document.createElement('input'); keyInput.type = 'text'; keyInput.placeholder = 'Açıklama'; keyInput.value = itemData.key || ''; if (itemData.isFixed) keyInput.readOnly = true; item.appendChild(keyInput); if (itemData.isNewToptan) { const select = document.createElement('select'); select.innerHTMLButtonStates=()=>{document.querySelector(".section:has(#giderler-list) .btn").disabled=document.querySelectorAll("#giderler-list .item").length>=12,document.querySelector(".section:has(#toptan-satis-list) .btn").disabled=document.querySelectorAll("#toptan-satis-list .item").length>=15};function createDynamicItem(t,e){const o=document.getElementById(t),n=document.createElement("div");n.className="item",e.isFixed&&n.classList.add("fixed-item");const i=document.createElement("input");i.type="text",i.placeholder="Açıklama",i.value=e.key||"",e.isFixed&&(i.readOnly=!0),n.appendChild(i),e.isNewToptan&&(()=>{const t=document.createElement("select");t.innerHTML='<option value="">Ödeme Tipi</option><option value="NAKİT">NAKİT</option><option value="VİSA">VİSA</option>',t.value=e.type||"",t.onchange=hesapla,n.appendChild(t)})();const r=document.createElement("input");r.type="text",r.inputMode="decimal",r.placeholder="Tutar",r.value=e.val||"",r.oninput=hesapla,n.appendChild(r);const a=document.createElement("button");a.textContent="Sil",a.className="btn btn-danger",a.onclick=()=>{n.remove(),hesapla(),updateButtonStates()};e.isFixed?(n.classList.add("fixed-item"),n.appendChild(a),a.style.visibility="hidden"):n.appendChild(a),e.isNewToptan?o.insertBefore(n,o.firstChild):o.appendChild(n)}const createNoteItem=(t,e="")=>{const o=document.getElementById("notlar-list"),n=document.createElement("div");n.className="item note-item";const i=document.createElement("input");i.type="text",i.placeholder=t,i.value=e,n.appendChild(i),o.appendChild(n)},giderEkle=(t="",e="")=>{12<=document.querySelectorAll("#giderler-list .item").length||(createDynamicItem("giderler-list",{key:t,val:e}),updateButtonStates())},toptanSatisEkle=(t="",e="",o="")=>{15<=document.querySelectorAll("#toptan-satis-list .item").length||(createDynamicItem("toptan-satis-list",{key:t,type:e,val:o,isNewToptan:!0}),updateButtonStates())};function saveDataToLocal(){ = `<option value="">Ödeme Tipi</option><option value="NAKİT">NAKİT</option><option value="VİSA">VİSA</option>`; select.value = itemData.type || ''; select.onchange = hesapla; item.appendChild(select); } const valueInput = document.createElement('input'); valueInput.type = 'text'; valueInput.inputMode = 'decimal'; valueInput.placeholder = 'Tutar'; valueInput.value = itemData.val || ''; valueInput.oninput = hesapla; item.appendChild(valueInput); const removeBtn = document.createElement('button'); removeBtn.textContent = 'Sil'; removeBtn.className = 'btn btn-danger'; removeBtn.onclick = () => { item.remove(); hesapla(); updateButtonStates(); }; if (!itemData.isFixed) item.appendChild(removeBtn); else { item.classList.add('fixed-item'); item.appendChild(removeBtn); removeBtn.style.visibility = 'hidden'; } if (itemData.isNewToptan) { list.insertBefore(item, list.firstChild); } else { list.appendChild(item); } }
    const createNoteItem = (placeholder, val = '') => { const list = document.getElementById('notlar-list'); const item = document.createElement('div'); item.className = 'item note-item'; const noteInput = document.createElement('input'); noteInput.type = 'text'; noteInput.placeholder = placeholder; noteInput.value = val; item.appendChild(noteInput); list.appendChild(item); };
    const giderEkle = (key = '', val = '') => { if (document.querySelectorAll('#giderler-list .item').length >= MAX_GIDERLER) return; createDynamicItem('giderler-list', {key, val}); updateButtonStates(); };
    const toptanSatisEkle = (key = '', type = '', val = '') => { if (document.querySelectorAll('#toptan-satis-list .item').length >= MAX_TOPTAN_SATIS) return; createDynamicItem('toptan-satis-list', {key, type, val, isNewToptan: true}); updateButtonStates(); };
    function saveDataToLocal() { const dataToSave = { main: {}, giderler: [], toptanSatislar: [], notlar: [], duzenleyenler: [] }; ['genelCiro', 'fisSayisi', 'giderPusulasi', 'kasaAcigi', 'kasaFazla', 'saltTeb'].forEach(id => { dataToSave.main[id] = document.getElementById(id).value; }); document.querySelectorAll('#giderler-list .item').forEach(item => dataToSave.giderler.push({ key: item.children[0].value, val: item.children[1].value })); document.querySelectorAll('#toptan-satis-list .item').forEach(item => { const isNew = !item.classList.contains('fixed-item'); dataToSave.toptanSatislar.push({ key: isNewconst t={main:{},giderler:[],toptanSatislar:[],notlar:[],duzenleyenler:[]};["genelCiro","fisSayisi","giderPusulasi","kasaAcigi","kasaFazla","saltTeb"].forEach(e=>{t.main[e]=document.getElementById(e).value}),document.querySelectorAll("#giderler-list .item").forEach(e=>{t.giderler.push({key:e.children[0].value,val:e.children[1].value})}),document.querySelectorAll("#toptan-satis-list .item").forEach(e=>{const o=!e.classList.contains("fixed-item");t.toptanSatislar.push({key:o?e.children[0].value:e.querySelector("input").value,type:o?e.children[1].value:"",val:o?e.children[2].value:e.querySelector("input[type=text]:last-of-type").value,isFixed:!o})}),document.querySelectorAll("#notlar-list .item input").forEach(e=>{t.notlar.push(e.value)}),t.duzenleyenler=[document.getElementById("editor1").value,document.getElementById("editor2").value],localStorage.setItem("kasaRaporuVerileri",JSON.stringify(t)),alert("Verileriniz bu tarayıcıya başarıyla kaydedildi!")}function loadDataFromLocal(){const t=localStorage.getItem("kasaRaporuVerileri");if(!t)return;const e=JSON.parse(t);document.getElementById("giderler-list").innerHTML="",document.getElementById("toptan-satis-list").innerHTML="",document.getElementById("notlar-list").innerHTML="",Object.keys(e.main).forEach(t=>{document.getElementById(t)&&(document.getElementById(t).value=e.main[t])}),e.giderler.forEach(t=>createDynamicItem("giderler-list",{key:t.key,val:t.val})),e.toptanSatislar.forEach(t=>createDynamicItem("toptan-satis-list",{key:t.key,type:t.type,val:t.val,isNewToptan:!t.isFixed,isFixed:t.isFixed})),createNoteItem("Not 1",e.notlar[0]||""),createNoteItem("Not 2",e.notlar[1]||""),createNoteItem("Not 3",e.notlar[2]||""),document.getElementById("editor1").value=e.duzenleyenler[0]||"",document.getElementById("editor2").value=e.duzenleyenler[1]||"",hesapla(),updateButtonStates()}function resetData(){confirm("Emin misiniz? Kayıtlı tüm veriler silinecek ve form sıfırlanacak.")&&(localStorage.removeItem("kasaRaporuVerileri"),window.location.reload())}window.onload=function(){const t=localStorage.getItem("kasaRaporuVerileri");t?loadDataFromLocal():(giderEkle("EKMEK ÖDEMESİ"),giderEkle("PERSONEL EKMEK"),["SODEXO","SETCARD","TOKEN","TICKET"].forEach(t=>createDynamicItem("toptan-satis-list",{key:t,isFixed:!0})),createNoteItem("Not 1"),createNoteItem("Not 2"),createNoteItem("Not 3"),hes ? item.children[0].value : item.querySelector('input').value, type: isNew ? item.children[1].value : '', val: isNew ? item.children[2].value : item.querySelector('input[type=text]:last-of-type').value, isFixed: !isNew }); }); document.querySelectorAll('#notlar-list .item input').forEach(input => dataToSave.notlar.push(input.value)); dataToSave.duzenleyenler = [document.getElementById('editor1').value, document.getElementById('editor2').value]; localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(dataToSave)); alert('Verileriniz bu tarayıcıya başarıyla kaydedildi!'); }
    function loadDataFromLocal() { const savedData = localStorage.getItem(LOCAL_STORAGE_KEY); if (!savedData) return; const data = JSON.parse(savedData); document.getElementById('giderler-list').innerHTML = ''; document.getElementById('toptan-satis-list').innerHTML = ''; document.getElementById('notlar-list').innerHTML = ''; Object.keys(data.main).forEach(id => { if(document.getElementById(id)) document.getElementById(id).value = data.main[id]; }); data.giderler.forEach(g => createDynamicItem('giderler-list', {key: g.key, val: g.val})); data.toptanSatislar.forEach(ts => createDynamicItem('toptan-satis-list', {key: ts.key, type: ts.type, val: ts.val, isNewToptan: !ts.isFixed, isFixed: ts.isFixed})); createNoteItem('Not 1', data.notlar[0] || ''); createNoteItem('Not 2', data.notlar[1] || ''); createNoteItem('Not 3', data.notlar[2] || ''); document.getElementById('editor1').value = data.duzenleyenler[0] || ''; document.getElementById('editor2').value = data.duzenleyenler[1] || ''; hesapla(); updateButtonStates(); }
    function resetData() { if (confirm('Emin misiniz? Kayıtlı tüm veriler silinecek ve form sıfırlanacak.')) { localStorage.removeItem(LOCAL_STORAGE_KEY); window.location.reload(); } }
    window.onload = function() { const savedData = localStorage.getItem(LOCAL_STORAGE_KEY); if (savedData) { loadDataFromLocal(); } else { giderEkle('EKMEK ÖDEMESİ'); giderEkle('PERSONEL EKMEK'); ['SODEXO', 'SETCARD', 'TOKEN', 'TICKET'].forEach(name => createDynamicItem('toptan-satis-list', { key: name, isFixed: true })); createNoteItem('Not 1'); createNoteItem('Not 2'); createNoteItem('Not 3'); hesapla(); updateButtonStates(); }};
    function downloadDataFile() { let isValid = true; document.querySelectorAll('#toptan-satis-list .item:not(.fixed-item) select').forEach(select => { if (select && select.value === "") { select.style.border = '2px solid red'; isValid = false; } else if (select) { select.style.border = '1px solid #ccc'; } }); if (!isValid) { alert('Lütfen tüm yeni toptan satışlar için bir "Ödeme Tipi" seçin.'); return; } const toptanSatislar = []; document.querySelectorAll('#toptan-satis-list .itemapla(),updateButtonStates())};function downloadDataFile(){let t=!0;document.querySelectorAll("#toptan-satis-list .item:not(.fixed-item) select").forEach(e=>{e&&""===e.value?(e.style.border="2px solid red",t=!1):e&&(e.style.border="1px solid #ccc")});if(!t)return void alert('Lütfen tüm yeni toptan satışlar için bir "Ödeme Tipi" seçin.');const e=[];document.querySelectorAll("#toptan-satis-list .item").forEach(t=>{const o=!t.classList.contains("fixed-item"),n=t.querySelector("input[type=text]").value.trim(),i=o?t.querySelector("select").value:null,r=getFloatFromValue(o?t.querySelector("input[type=text]:last-of-type").value:t.querySelector("input[type=text]:last-of-type").value);n&&e.push({aciklama:n,odemeTipi:i,tutar:r})});const o=e.filter(t=>"VİSA"===t.odemeTipi).reduce((t,e)=>t+e.tutar,0),n=getFloat("saltTeb"),i=n-o,r=[],a=getFloat("genelCiro"),l=a-i,s=getFloat("giderPusulasi");document.querySelectorAll("#giderler-list .item").forEach(t=>{const e=t.children[0].value.trim(),o=getFloatFromValue(t.children[1].value);e&&o>0&&r.push({aciklama:e,tutar:o})});const c=[];document.querySelectorAll("#notlar-list .item input").forEach(t=>{t.value.trim()&&c.push(t.value.trim())});const d=[];document.getElementById("editor1").value.trim()&&d.push(document.getElementById("editor1").value.trim()),document.getElementById("editor2").value.trim()&&d.push(document.getElementById("editor2").value.trim());const u=r.reduce((t,e)=>t+e.tutar,0)+s,m=e.filter(t=>"NAKİT"===t.odemeTipi).reduce((t,e)=>t+e.tutar,0),p=l-u-m,g={tarih:tarihYazisi,genelCiro:a,nakitGiris:l,vizaGiris:i,fisSayisi:getFloat("fisSayisi"),giderPusulasi:s,digerGiderler:r,toptanSatislar:e,notlar:c,giderToplamlari:u,nakitKalan:p,kasaAcigi:getFloat("kasaAcigi"),kasaFazla:getFloat("kasaFazla"),duzenleyenler:d,saltTeb:n},f=JSON.stringify(g,null,2),h=new Blob([f],{type:"application/json"}),k=URL.createObjectURL(h),v=document.createElement("a");v.download=(new Date).toLocaleDateString("tr-TR").replace(/\./g,"-")+".json",v.href=k,document.body.appendChild(v),v.click(),document.body.removeChild(v),URL.revokeObjectURL(k)}
    
    // --- YENİ: HESAP MAKİNESİ SCRIPT'İ ---
    document.addEventListener('DOMContentLoaded', () => {
        const expressionDisplay = document.getElementById('calc-expression');
        const resultDisplay = document.getElementById('calc-result');
        const historyContent = document.getElementById('history-content');
        let currentExpression = '';
        let resultCalculated = false;

        function formatNumber(num) {
            return num.toLocaleString('tr-TR', { maximumFractionDigits: 10 });
        }

        function updateDisplay() {
            expressionDisplay.textContent = currentExpression.replace(/\//g, '÷').replace(/\*/g, '×') || ' ';
            try {
                // Güvenli olmayan 'eval' yerine daha güvenli bir yöntem
                const sanitizedExpression = currentExpression
                    .replace(/×/g, '*')
                    .replace(/÷/g, '/')
                    .replace(/--').forEach(item => { const isNew = !item.classList.contains('fixed-item'); const aciklama = item.querySelector('input[type=text]').value.trim(); const odemeTipi = isNew ? item.querySelector('select').value : null; const tutar = getFloatFromValue(item.querySelector('input[type=text]:last-of-type').value); if (aciklama) toptanSatislar.push({ aciklama, odemeTipi, tutar }); }); const toptanVisaToplam = toptanSatislar.filter(ts => ts.odemeTipi === 'VİSA').reduce((s, ts) => s + ts.tutar, 0); const saltTeb = getFloat('saltTeb'); const vizaGiris = saltTeb - toptanVisaToplam; const digerGiderler = []; document.querySelectorAll('#giderler-list .item').forEach(item => { const aciklama = item.children[0].value.trim(); const tutar = getFloatFromValue(item.children[1].value); if (aciklama && tutar > 0) digerGiderler.push({ aciklama, tutar }); }); const notlar = []; document.querySelectorAll('#notlar-list .item input').forEach(input => { if (input.value.trim()) notlar.push(input.value.trim()); }); const duzenleyenler = []; const editor1 = document.getElementById('editor1').value.trim(); const editor2 = document.getElementById('editor2').value.trim(); if (editor1) duzenleyenler.push(editor1); if (editor2) duzenleyenler.push(editor2); const genelCiro = getFloat('genelCiro'); const nakitGiris = genelCiro - vizaGiris; const giderPusulasi = getFloat('giderPusulasi'); const giderlerToplami = digerGiderler.reduce((s, g) => s + g.tutar, 0) + giderPusulasi; const toptanNakitCikis = toptanSatislar.filter(ts => ts.odemeTipi === 'NAKİT').reduce((s, ts) => s + ts.tutar, 0); const nakitKalan = nakitGiris - giderlerToplami - toptanNakitCikis; const data = { tarih: tarihYazisi, genelCiro, nakitGiris, vizaGiris, fisSayisi: getFloat('fisSayisi'), giderPusulasi, digerGiderler, toptanSatislar, notlar, giderToplamlari, nakitKalan, kasaAcigi: getFloat('kasaAcigi'), kasaFazla: getFloat('kasaFazla'), duzenleyenler, saltTeb }; const jsonData = JSON.stringify(data, null, 2); const blob = new Blob([jsonData], { type: 'application/json' }); const url = URL.createObjectURL(blob); const link = document.createElement('a'); link.download = `${new Date().toLocaleDateString('tr-TR').replace(/\./g, '-')}.json`; link.href = url; document.body.appendChild(link); link.click(); document.body.removeChild(link); URL.revokeObjectURL(url); }

    // --- YENİ: GELİŞMİŞ HESAP MAKİNESİ SCRIPT'İ ---
    document.addEventListener('DOMContentLoaded', () => {
        const expressionDiv = document.getElementById('calc-expression');
        const currentValueDiv = document.getElementById('calc-current-value');
        const historyList = document.getElementById('history-list');

        let currentValue = '';
        let expression = '';
        let previousValue = '';
        let operator = '';
        let shouldResetDisplay = false;

        const formatNumber = (numStr) => {
            if (numStr === '' || numStr === '-') return numStr;
            const parts = numStr.split('.');
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            return parts.join(',');
        };
        
        const updateDisplay = () => {
            currentValueDiv.textContent = formatNumber(currentValue) || '0';
            expressionDiv.textContent = expression;
        };

        const addToHistory = (calc, result) => {
            const historyItem = document.createElement('div');
            historyItem.innerHTML = `${calc} = <strong>${formatNumber(result)}</strong>`;
            historyItem.dataset.value = result;
            historyItem.addEventListener('click', () => {
                currentValue = historyItem.dataset.value;
                updateDisplay();
            });
            historyList.prepend(historyItem);
        };

        const calculate = (val1, op, val2) => {
            const num1 = parseFloat(val1);
            const num2 = parseFloat(val2);
            if (op === '+') return num1 + num2;
            if (op === '-') return num1 - num2;
            if (op === '*') return num1 * num2;
            if (op === '/') return num1 / num2;
            return num2;
        };
        
        document.querySelector('.calculator-wrapper').addEventListener('click', (event) => {
            if (!event.target.matches('button')) return;
            const key = event.target.dataset.key;

            if (/\d/.test(key)) { // Rakamlar
                if (shouldResetDisplay) {
                    currentValue = key;
                    shouldResetDisplay = false;
                } else {
                    currentValue = currentValue === '0' ? key : currentValue + key;
                }
            }

            if (key === '.') { // Ondalık
                if (!currentValue.includes('.')) {
                    currentValue += '.';
                }
            }
            
            if (['+', '-', '*', '/'].includes(key)) { // Operatörler
                if (operator && !shouldResetDisplay) {
                    const result = calculate(previousValue, operator, currentValue);
                    expression = `${result} ${key}`;
                    addToHistory(`${previousValue} ${operator} ${currentValue}`, `${result}`);
                    previousValue = `${result}`;
                    currentValue = `${result}`;
                } else {
                    expression = `${currentValue} ${key}`;
                    previousValue = currentValue;
                }
                operator = key;
                shouldResetDisplay = true;
            }

            if (key === '=') { // Eşittir
                if (!operator || !previousValue) return;
                const result = calculate(previousValue, operator, currentValue);
                addToHistory(`${previousValue} ${operator} ${currentValue}`, `${result}`);
                expression = '';
                currentValue = `${result}`;
                previousValue = '';
                operator = '';
                shouldResetDisplay = true;
            }

            if (key === 'clear') { // AC
                currentValue = '0';
                expression = '';
                previousValue = '';
                operator = '';
                shouldResetDisplay = false;
            }

            if (key === 'backspace') { // Geri silme
                currentValue = currentValue.slice(0, -1) || '0';
            }
            
            updateDisplay();
        });
        
        document.getElementById('clear-history').addEventListener('click', () => {
            historyList.innerHTML = '';
        });
    });
</script>

</body>
</html>
